# Bpsysio-Ephys
This repository aims to predict the days _in vitro_ of whole-cell patch-clamped hIPSC derived neurons with the use of machine learning.

## Table of contents
1. [Installation](#installation)
2. [Data](#data)
3. [Usage](#usage)
4. [Models](#models)
5. [Contact](#contact)

## Installation
Clone repository
```
git clone https://github.com/wesleysSon/Bpsysio-Ephys.git
```
Dependencies will be installed locally when running the Jupyter notebook. However, it is recommended to use pipenv to manage dependencies and resolve any version issues.

## Data
This dataset resulted from an electrophysiological analysis of human iPSC differentiated into neurons. The dataset consists of columns where each column contains a measurement feature of the electrophysiological analysis. The data were gathered over the span of three years, where the cells were cultured by six different people, and contained four different genotypes (TSC12.3, CT3&CT4, 995.3 and WTC), which are all control cell lines. A subset of the original dataset will be used initially for this analysis. \
The subset includes the following features: 
* Batch number
* Genotype Neuron
* Div calculated
* Culture treatment
* Capacitance
* Input Resistance
* Resting membrane potential
* Maximum firing
* Rheobase
* EPSC freq

The data used for this analysis is store in the `/data` directory. 

## Usage
To use this project, follow these steps:
1. Clone repository to the directory of choice.
2. Open the jupyter notebook and run the cells to preprocess the data and train the models.
3. Evaluate the plots and tables generated by the workflow in the map `run`

You can specify the run name in the variable `run_name` if you want to customise the parameters in the workflow. This variable is located in the chunk `#Loading data`. Below the code related to this chunk: 
```
"""
Load data from an Excel file and extract specific features.
"""

# Specify the run. 
run_name = 'run_1' # 'run1' or 'run2'

# Load data from an Excel file.
print("Loading data...")
data = pd.read_excel("data/01. Master_Latest data_Control clones_LP.xlsx", engine='openpyxl')
data_extracted_features = pd.read_excel("data/01. Master_Latest data_Control clones_LP.xlsx", usecols=['Batch number', 'Genotype Neuron', 'Div calculated', 'Culture treatment', 'Cultured by', 'Capacitance', 'Input Resistance', 'Resting membrane potential ', 'Maximum firing ', 'Rheobase', 'EPSC freq'])

# Display the data.
print("\n")
print(data_extracted_features.dtypes)
print(data_extracted_features)
```

## Models
[Scikit-learn](https://scikit-learn.org/stable/index.html) was used to implement machine learning into the workflow. The following machine learning models were used to predict the days _in vitro_ : 
1. KMeans
2. Linear regression
3. Random forest classifier
4. Random forest regressor
5. Support vector machine
6. Elastic net regression (paramter tuning implemented)

To use specific parameters, find the chuck related to the model where you want to change the parameter and change the parameters where the model is initialised. We recommend to use `random_state=0` or `np.random.seed(42)` to retain reproducablity. You can find an example for each model model below with a link to the related scikit-learn page.

1. [KMeans](https://scikit-learn.org/stable/modules/generated/sklearn.cluster.KMeans.html)
   Code snippet from workflow where KMeans is initialised
   ```
   kmeans = KMeans(n_clusters=len(data_extracted_features_imputed_combat_categorical[feature].unique()), random_state=0)
   ```
   Example custom parameters
   ```
   kmeans = KMeans(n_clusters=10, max_iter=300, random_state=0)
   ```
2. [Linear regression](https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html)
   Code snippet from workflow
   ```
   # Initialize the linear regression model
   regr = LinearRegression() 
   ```
   Example custom parameters
   ```
   # Initialize the linear regression model
   regr = LinearRegression(fit_intercept=False)
   ```
3. [Random forest classifier](https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html)
   Code snippet from workflow
   ```
   # Initialize the classifier
   rf = RandomForestClassifier(random_state=0, n_estimators=100)
   ```
   Example custom paramters
   ```
   # Initialize the classifier
   rf = RandomForestClassifier(n_estimators=250, min_samples_split=2, random_state=0)
   ```
4. [Random forest regressor](https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html)
   Code snippet from workflow
   ```
   # Initialize the regressor
   rf = RandomForestRegressor(random_state=0, n_estimators=1000)
   ```
   Example custom paramters
   ```
   # Initialize the regressor
   rf = RandomForestRegressor(n_estimators=1000, max_features=1.0, bootstrap=False, random_state=0)
   ```
5. [Support vector machine](https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVR.html#svr)
   Code snippet from workflow
   ```
   # Initialize the SVR model
   svm = SVR(kernel='linear', C=1.0)
   ```
   Example custom paramters
   ```
   # Initialize the SVR model
   svm = SVR(kernel='rbf', C=1.0, degree=3, gamma='scale')
   ```  
6. [Elastic net regression](https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.ElasticNet.html)
   Code snippet from workflow
   ```
   regr = ElasticNet(random_state=0)
   ```
   Example custom paramters
   ```
   regr = ElasticNet(alpha=2.0, max_iter=1000, random_state=0)
   ```     

**NOTE:** The plots from elastic net regression will not be saved.

## Contact
If you encounter any issues accessing the data or have questions regarding the workflow, please feel free to reach out using the contact information provided below.
\
Linkedin: [Wesley Sontowirono](https://www.linkedin.com/in/wesley-sontowirono-810164165/)
\
email: wesleysontowirono@gmail.com
